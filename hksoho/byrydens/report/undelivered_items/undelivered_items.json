{
 "add_total_row": 1,
 "add_translate_data": 0,
 "columns": [],
 "creation": "2025-09-20 15:52:31.802008",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "letter_head": "Company Logo header",
 "letterhead": null,
 "modified": "2025-09-20 17:05:42.942754",
 "modified_by": "Administrator",
 "module": "byrydens",
 "name": "Undelivered Items",
 "owner": "Administrator",
 "prepared_report": 0,
 "query": "SELECT\r\n    po.po_number AS `PO Number`,\r\n    po.supplier AS `Supplier`,\r\n    po.origin_port AS `Loading Port`,\r\n    po.buyer AS `Buyer`,\r\n    po.dc_warehousestore AS `Dest DC`,\r\n    poi.line AS `Line No`,\r\n    poi.article_number AS `Art Nr`,\r\n    poi.article_name AS `Art Name`,\r\n    u.full_name AS `Coordinator`,\r\n    poi.requested_qty AS `Order Qty`,\r\n    poi.confirmed_qty AS `Cfd Qty`,\r\n    poi.delivery_qty AS `Dvy Qty`,\r\n    (poi.requested_qty - poi.confirmed_qty) AS `Cancelled Qty`,\r\n    poi.remaining_qty AS `Remain Qty`,\r\n    (poi.confirmed_qty * COALESCE(p.carton_cbm_outer_carton, 0)) AS `Cfd Cbm`,\r\n    (poi.delivery_qty * COALESCE(p.carton_cbm_outer_carton, 0)) AS `Dvy Cbm`,\r\n    (poi.remaining_qty * COALESCE(p.carton_cbm_outer_carton, 0)) AS `Remain Cbm`,\r\n    po.po_shipdate AS `PO ShipDate`,\r\n    po.po_placed AS `Order Date`,\r\n    poi.confirmed_shipdate AS `Cfd Date`,\r\n    poi.actual_finishdate AS `Dvy Date`,\r\n    po.requested_dc_eta AS `Calc DC ETA`,\r\n    (poi.confirmed_qty * poi.unit_price) AS `Cfd Value`,\r\n    (poi.delivery_qty * poi.unit_price) AS `Dvy Value`,\r\n    (poi.remaining_qty * poi.unit_price) AS `Remain Value`,\r\n    po.order_purchase_currency AS `Currency`,\r\n    po.po_status AS `PO Status`,\r\n    p.range AS `Range`\r\nFROM\r\n    `tabPurchase Order Item` poi\r\nINNER JOIN\r\n    `tabPurchase Order` po ON po.name = poi.parent\r\nLEFT JOIN\r\n    `tabProduct` p ON p.article_number = poi.article_number\r\nLEFT JOIN\r\n    `tabUser` u ON u.name = po.coordinator\r\nWHERE\r\n    po.po_status IN ('Confirmed')  -- \u8abf\u6574\u70ba shipout \u4e4b\u524d\u7684\u72c0\u614b\r\nORDER BY\r\n    po.po_number, poi.line;",
 "ref_doctype": "Purchase Order",
 "report_name": "Undelivered Items",
 "report_script": "def execute(filters=None):\r\n    columns = [\r\n        {\"label\": _(\"PO Number\"), \"fieldname\": \"po_number\", \"fieldtype\": \"Data\", \"width\": 120},\r\n        {\"label\": _(\"Supplier\"), \"fieldname\": \"supplier\", \"fieldtype\": \"Link\", \"options\": \"Partner\", \"width\": 150},\r\n        {\"label\": _(\"Loading Port\"), \"fieldname\": \"loading_port\", \"fieldtype\": \"Data\", \"width\": 100},\r\n        {\"label\": _(\"Buyer\"), \"fieldname\": \"buyer\", \"fieldtype\": \"Link\", \"options\": \"Partner\", \"width\": 150},\r\n        {\"label\": _(\"Dest DC\"), \"fieldname\": \"dest_dc\", \"fieldtype\": \"Select\", \"width\": 100},\r\n        {\"label\": _(\"Line No\"), \"fieldname\": \"line_no\", \"fieldtype\": \"Int\", \"width\": 80},\r\n        {\"label\": _(\"Art Nr\"), \"fieldname\": \"art_nr\", \"fieldtype\": \"Link\", \"options\": \"Product\", \"width\": 150},\r\n        {\"label\": _(\"Art Name\"), \"fieldname\": \"art_name\", \"fieldtype\": \"Data\", \"width\": 200},\r\n        {\"label\": _(\"Coordinator\"), \"fieldname\": \"coordinator\", \"fieldtype\": \"Data\", \"width\": 150},\r\n        {\"label\": _(\"Order Qty\"), \"fieldname\": \"order_qty\", \"fieldtype\": \"Int\", \"width\": 100},\r\n        {\"label\": _(\"Cfd Qty\"), \"fieldname\": \"cfd_qty\", \"fieldtype\": \"Int\", \"width\": 100},\r\n        {\"label\": _(\"Dvy Qty\"), \"fieldname\": \"dvy_qty\", \"fieldtype\": \"Int\", \"width\": 100},\r\n        {\"label\": _(\"Cancelled Qty\"), \"fieldname\": \"cancelled_qty\", \"fieldtype\": \"Int\", \"width\": 100},\r\n        {\"label\": _(\"Remain Qty\"), \"fieldname\": \"remain_qty\", \"fieldtype\": \"Int\", \"width\": 100},\r\n        {\"label\": _(\"Cfd Cbm\"), \"fieldname\": \"cfd_cbm\", \"fieldtype\": \"Float\", \"width\": 100},\r\n        {\"label\": _(\"Dvy Cbm\"), \"fieldname\": \"dvy_cbm\", \"fieldtype\": \"Float\", \"width\": 100},\r\n        {\"label\": _(\"Remain Cbm\"), \"fieldname\": \"remain_cbm\", \"fieldtype\": \"Float\", \"width\": 100},\r\n        {\"label\": _(\"PO ShipDate\"), \"fieldname\": \"po_shipdate\", \"fieldtype\": \"Date\", \"width\": 100},\r\n        {\"label\": _(\"Order Date\"), \"fieldname\": \"order_date\", \"fieldtype\": \"Date\", \"width\": 100},\r\n        {\"label\": _(\"Cfd Date\"), \"fieldname\": \"cfd_date\", \"fieldtype\": \"Date\", \"width\": 100},\r\n        {\"label\": _(\"Dvy Date\"), \"fieldname\": \"dvy_date\", \"fieldtype\": \"Date\", \"width\": 100},\r\n        {\"label\": _(\"Calc DC ETA\"), \"fieldname\": \"calc_dc_eta\", \"fieldtype\": \"Date\", \"width\": 100},\r\n        {\"label\": _(\"Cfd Value\"), \"fieldname\": \"cfd_value\", \"fieldtype\": \"Float\", \"width\": 100},\r\n        {\"label\": _(\"Dvy Value\"), \"fieldname\": \"dvy_value\", \"fieldtype\": \"Float\", \"width\": 100},\r\n        {\"label\": _(\"Remain Value\"), \"fieldname\": \"remain_value\", \"fieldtype\": \"Float\", \"width\": 100},\r\n        {\"label\": _(\"Currency\"), \"fieldname\": \"currency\", \"fieldtype\": \"Link\", \"options\": \"Currency\", \"width\": 80},\r\n        {\"label\": _(\"PO Status\"), \"fieldname\": \"po_status\", \"fieldtype\": \"Select\", \"width\": 100},\r\n        {\"label\": _(\"Range\"), \"fieldname\": \"range\", \"fieldtype\": \"Select\", \"width\": 150}\r\n    ]\r\n\r\n    conditions = \"po.po_status IN ('Confirmed')\"\r\n    if filters.get(\"po_number\"):\r\n        conditions += f\" AND po.name = '{filters.get('po_number')}'\"\r\n    if filters.get(\"supplier\"):\r\n        conditions += f\" AND po.supplier = '{filters.get('supplier')}'\"\r\n    if filters.get(\"buyer\"):\r\n        conditions += f\" AND po.buyer = '{filters.get('buyer')}'\"\r\n    if filters.get(\"dest_dc\"):\r\n        conditions += f\" AND po.dc_warehousestore = '{filters.get('dest_dc')}'\"\r\n    if filters.get(\"coordinator\"):\r\n        conditions += f\" AND po.coordinator = '{filters.get('coordinator')}'\"\r\n    if filters.get(\"order_date_from\"):\r\n        conditions += f\" AND po.po_placed >= '{filters.get('order_date_from')}'\"\r\n    if filters.get(\"order_date_to\"):\r\n        conditions += f\" AND po.po_placed <= '{filters.get('order_date_to')}'\"\r\n    if filters.get(\"po_status\"):\r\n        conditions += f\" AND po.po_status = '{filters.get('po_status')}'\"\r\n\r\n    data = frappe.db.sql(f\"\"\"\r\n        SELECT\r\n            po.po_number AS po_number,\r\n            po.supplier AS supplier,\r\n            po.origin_port AS loading_port,\r\n            po.buyer AS buyer,\r\n            po.dc_warehousestore AS dest_dc,\r\n            poi.line AS line_no,\r\n            poi.article_number AS art_nr,\r\n            poi.article_name AS art_name,\r\n            u.full_name AS coordinator,\r\n            poi.requested_qty AS order_qty,\r\n            poi.confirmed_qty AS cfd_qty,\r\n            poi.delivery_qty AS dvy_qty,\r\n            (poi.requested_qty - poi.confirmed_qty) AS cancelled_qty,\r\n            poi.remaining_qty AS remain_qty,\r\n            (poi.confirmed_qty * COALESCE(p.carton_cbm_outer_carton, 0)) AS cfd_cbm,\r\n            (poi.delivery_qty * COALESCE(p.carton_cbm_outer_carton, 0)) AS dvy_cbm,\r\n            (poi.remaining_qty * COALESCE(p.carton_cbm_outer_carton, 0)) AS remain_cbm,\r\n            po.po_shipdate AS po_shipdate,\r\n            po.po_placed AS order_date,\r\n            poi.confirmed_shipdate AS cfd_date,\r\n            poi.actual_finishdate AS dvy_date,\r\n            po.requested_dc_eta AS calc_dc_eta,\r\n            (poi.confirmed_qty * poi.unit_price) AS cfd_value,\r\n            (poi.delivery_qty * poi.unit_price) AS dvy_value,\r\n            (poi.remaining_qty * poi.unit_price) AS remain_value,\r\n            po.order_purchase_currency AS currency,\r\n            po.po_status AS po_status,\r\n            p.range AS range\r\n        FROM\r\n            `tabPurchase Order Item` poi\r\n        INNER JOIN\r\n            `tabPurchase Order` po ON po.name = poi.parent\r\n        LEFT JOIN\r\n            `tabProduct` p ON p.article_number = poi.article_number\r\n        LEFT JOIN\r\n            `tabUser` u ON u.name = po.coordinator\r\n        WHERE\r\n            {conditions}\r\n        ORDER BY\r\n            po.po_number, poi.line\r\n    \"\"\", as_dict=1)\r\n\r\n    return columns, data",
 "report_type": "Query Report",
 "roles": [
  {
   "role": "System Manager"
  },
  {
   "role": "Purchase Manager"
  },
  {
   "role": "Co-operator"
  }
 ],
 "timeout": 0
}